@model Project.Models.Product

@{
    ViewBag.Title = "Uređivanje proizvoda";
}

<h2>@ViewBag.Title</h2>
<span class="badge"></span>

@using (Html.BeginForm())
{
    @Html.AntiForgeryToken()
    @Html.HiddenFor(m => m.IDProduct)

    <div class="form-horizontal">
        <h4>Proizvod</h4>
        <hr />
        @Html.ValidationSummary(true, "", new { @class = "text-danger" })

        <div class="form-group">
            @Html.LabelFor(model => model.Name, htmlAttributes: new { @class = "control-label col-md-2" })
            <div class="col-md-10">
                @Html.EditorFor(model => model.Name, new { htmlAttributes = new { @class = "form-control" } })
                @Html.ValidationMessageFor(model => model.Name, "", new { @class = "text-danger" })
            </div>
        </div>

        <div class="form-group">
            @Html.LabelFor(model => model.ProductNumber, htmlAttributes: new { @class = "control-label col-md-2" })
            <div class="col-md-10">
                @Html.EditorFor(model => model.ProductNumber, new { htmlAttributes = new { @class = "form-control" } })
                @Html.ValidationMessageFor(model => model.ProductNumber, "", new { @class = "text-danger" })
            </div>
        </div>
        
        <div class="form-group">
            @Html.LabelFor(model => model.Color, htmlAttributes: new { @class = "control-label col-md-2" })
            <div class="col-md-10">
                @Html.EditorFor(model => model.Color, new { htmlAttributes = new { @class = "form-control" } })
                @Html.ValidationMessageFor(model => model.Color, "", new { @class = "text-danger" })
            </div>
        </div>
        
        <div class="form-group">
            @Html.LabelFor(model => model.MinQuantityAtLager, htmlAttributes: new { @class = "control-label col-md-2" })
            <div class="col-md-10">
                @Html.EditorFor(model => model.MinQuantityAtLager, new { htmlAttributes = new { @class = "form-control" } })
                @Html.ValidationMessageFor(model => model.MinQuantityAtLager, "", new { @class = "text-danger" })
            </div>
        </div>
        
        <div class="form-group">
            @Html.LabelFor(model => model.PriceWithoutPDV, htmlAttributes: new { @class = "control-label col-md-2" })
            <div class="col-md-10">
                @Html.EditorFor(model => model.PriceWithoutPDV, new { htmlAttributes = new { @class = "form-control" } })
                @Html.ValidationMessageFor(model => model.PriceWithoutPDV, "", new { @class = "text-danger" })
            </div>
        </div>
        
        <div class="form-group">
            @Html.LabelFor(model => model.SubcategoryID, htmlAttributes: new { @class = "control-label col-md-2" })
            <div class="col-md-10">
                @Html.EditorFor(model => model.SubcategoryID, new { htmlAttributes = new { @class = "form-control" } })
                @Html.ValidationMessageFor(model => model.SubcategoryID, "", new { @class = "text-danger" })
            </div>
        </div>

        <div class="form-group">
            <div class="col-md-offset-2 col-md-10">
                <input type="submit" value="Save" class="btn btn-success" />
            </div>
        </div>
    </div>
}

<div>
    @Html.ActionLink("<<<Povratak na listu proizvoda", "Show")
</div>


@section scripts {
    @Scripts.Render("~/bundles/jqueryval")
    <script>
        $('form').on('submit', function (e) {
            e.preventDefault();
            const form = $(e.target);
            const product = {};

            if (form.valid()) {
                const params = form.serializeArray();
                params.forEach(param => {
                    if (param.name.lastIndexOf('__') != -1) {
                        return;
                    }
                    product[param.name] = param.value;
                })

                $.ajax({
                    url: '@Url.Action(controllerName:"Product", actionName:"Edit")',
                    data: product,
                    method: 'post',
                    statusCode: {
                        200: function () {
                            $('.badge').html('Proizvod uspješno ažuriran');
                            setTimeout(function () {
                                window.location = '@Url.Action(controllerName:"Product", actionName: "Show")';
                            }, 2000);
                        },
                        400: function () {
                            $('.badge').html('Proizvod nije ažuriran');
                        }
                    }
                })
            }
        })
    </script>
}
